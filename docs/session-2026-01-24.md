# Session Log - January 24, 2026

## Bug Fixes
- **Terrain blocking spawns** - Added validation to ensure random terrain doesn't block units in their spawn positions (each spawn must have at least one adjacent walkable tile)
- **Win message cut off** - Fixed "Player 2 Wins" text being clipped by widening container from 400px to 600px
- **LOS algorithm rewrite** - Replaced Bresenham-based LOS with mathematical line-rectangle intersection. New rules: line must be unobstructed from tile center to tile center; if line passes through a tile's interior (terrain OR unit) it's blocked; corner grazing only blocks if TERRAIN is on BOTH sides of the line (units on corners don't block diagonals)
- **Conceal double-use** - Fixed issue where using Conceal twice would toggle it off; now Conceal always activates (can't queue if already concealed)

## Balance Changes
- **Melee damage** - Melee attacks now deal 2x damage compared to ranged
- **Melee range** - Melee can now attack all 8 adjacent tiles (including diagonals), with LOS check for diagonals
- **Ranged deadzone** - Ranged attacks now exclude all 8 adjacent tiles (was only 4 ordinal)
- **Melee cover** - Melee soldiers now cover all 8 adjacent tiles (with LOS check for diagonals)
- **Hit sounds** - Sword attacks play heavy hit sound, gun attacks play medium hit sound
- **Speed bonus reduced** - Bonus for skipping actions cut in half (0.25 per unused action, was 0.5)

## Ability Updates
- **Cover & Conceal interaction** - Concealed units no longer trigger Cover at all (check happens after each action, so using Conceal as first action in a covered square allows second action to proceed safely)
- **Cover duration** - Cover now automatically ends at the start of the covering unit's next turn (in addition to ending after a counter attack or if hit)
- **Cover description updated** - "When activated, enemies that finish any action in a covered square are counter attacked, interrupting their remaining actions. Concealed enemies do not trigger Cover. Cover ends at the start of this unit's next turn, after a counter attack, or if this unit is hit."
- **Conceal description updated** - Added that concealed units won't trigger enemy Cover, allowing them to slip past defended positions
- **Conceal break sound** - Now plays hit-light sound when conceal is broken (instead of weapon-based heavy/medium)

## Visual Updates
- **Conceal team tint** - Concealed units now have a semi-transparent effect tinted with their team color (via emissive) instead of just white/transparent
- **Cover marker transparency** - Reduced cover border opacity (active: 0.4, preview: 0.2, dual-covered: 0.4) for a more subtle appearance

## UI Updates
- **Attack button renamed** - Shows "Strike" for melee units, "Shoot" for ranged units (also updated in queued action preview)
- **Weapon descriptions** - Updated melee to "Attacks all 8 adjacent spaces within line of sight", ranged to "except the 8 adjacent spaces"
- **Movement highlighting** - Enemy tiles no longer highlight red during movement mode (only in attack mode)
